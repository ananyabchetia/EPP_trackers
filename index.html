<!doctype html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <link rel="icon" type="image/png" href="./image/magnifyingglass.png" />
    <title>EPP Complaints Tracker</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/PapaParse/5.3.2/papaparse.min.js"></script>
    <link
      href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap"
      rel="stylesheet"
    />
    <style>
      * {
        margin: 0;
        padding: 0;
        box-sizing: border-box;
      }

      body {
        font-family:
          "Inter",
          -apple-system,
          BlinkMacSystemFont,
          "Segoe UI",
          sans-serif;
        background: #f8f9fc;
        min-height: 100vh;
        padding: 20px;
        color: #1a202c;
        line-height: 1.6;
      }

      .container {
        max-width: 1200px;
        margin: 0 auto;
      }

      header {
        text-align: center;
        margin-bottom: 48px;
        padding: 40px 20px;
      }

      h1 {
        font-size: 2.5em;
        font-weight: 700;
        color: #1a202c;
        margin-bottom: 12px;
        letter-spacing: -0.5px;
      }

      .subtitle {
        font-size: 1.1em;
        color: #718096;
        font-weight: 400;
      }

      .stats {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
        gap: 24px;
        margin-bottom: 40px;
      }

      .stat-card {
        background: white;
        padding: 32px;
        border-radius: 12px;
        box-shadow:
          0 1px 3px rgba(0, 0, 0, 0.06),
          0 1px 2px rgba(0, 0, 0, 0.04);
        transition: all 0.3s ease;
        border: 1px solid #e2e8f0;
      }

      .stat-card:hover {
        box-shadow: 0 10px 25px rgba(0, 0, 0, 0.08);
        transform: translateY(-2px);
      }

      .stat-number {
        font-size: 3em;
        color: #2d3748;
        font-weight: 700;
        margin-bottom: 8px;
        line-height: 1;
      }

      .stat-label {
        color: #718096;
        font-size: 0.95em;
        font-weight: 500;
        text-transform: uppercase;
        letter-spacing: 0.5px;
      }

      .search-box {
        background: white;
        padding: 24px;
        border-radius: 12px;
        margin-bottom: 24px;
        box-shadow: 0 1px 3px rgba(0, 0, 0, 0.06);
        border: 1px solid #e2e8f0;
      }

      .search-wrapper {
        position: relative;
      }

      .search-icon {
        position: absolute;
        left: 16px;
        top: 50%;
        transform: translateY(-50%);
        color: #a0aec0;
        pointer-events: none;
      }

      input[type="text"] {
        width: 100%;
        padding: 14px 16px 14px 44px;
        border: 2px solid #e2e8f0;
        border-radius: 8px;
        font-size: 1em;
        transition: all 0.3s ease;
        font-family: inherit;
      }

      input[type="text"]:focus {
        outline: none;
        border-color: #4299e1;
        box-shadow: 0 0 0 3px rgba(66, 153, 225, 0.1);
      }

      .table-container {
        background: white;
        border-radius: 12px;
        overflow: hidden;
        box-shadow: 0 1px 3px rgba(0, 0, 0, 0.06);
        border: 1px solid #e2e8f0;
      }

      table {
        width: 100%;
        border-collapse: collapse;
      }

      thead {
        background: #f7fafc;
      }

      th {
        padding: 18px 24px;
        text-align: left;
        font-weight: 600;
        font-size: 0.85em;
        text-transform: uppercase;
        letter-spacing: 0.5px;
        color: #4a5568;
        border-bottom: 2px solid #e2e8f0;
        cursor: pointer;
        user-select: none;
        transition: background 0.2s;
      }

      th:hover {
        background: #edf2f7;
      }

      th::after {
        content: " ‚Üï";
        opacity: 0.3;
        font-size: 0.8em;
      }

      td {
        padding: 20px 24px;
        border-bottom: 1px solid #f0f0f0;
        color: #2d3748;
      }

      tbody tr {
        transition: all 0.2s ease;
      }

      tbody tr:hover {
        background-color: #f7fafc;
      }

      tbody tr:last-child td {
        border-bottom: none;
      }

      .complaint-link {
        color: #4299e1;
        text-decoration: none;
        font-weight: 500;
        display: inline-flex;
        align-items: center;
        gap: 6px;
        transition: color 0.2s;
      }

      .complaint-link:hover {
        color: #2b6cb0;
        text-decoration: underline;
      }

      .complaint-link::after {
        content: "‚Üí";
        font-size: 1.1em;
      }

      .view-all-btn {
        text-align: center;
        padding: 24px;
      }

      .btn {
        background: #4299e1;
        color: white;
        border: none;
        padding: 14px 32px;
        border-radius: 8px;
        font-size: 1em;
        font-weight: 600;
        cursor: pointer;
        transition: all 0.3s ease;
        box-shadow: 0 4px 6px rgba(66, 153, 225, 0.15);
      }

      .btn:hover {
        background: #3182ce;
        box-shadow: 0 6px 12px rgba(66, 153, 225, 0.25);
        transform: translateY(-1px);
      }

      .btn:active {
        transform: translateY(0);
      }

      .info-section {
        margin-top: 64px;
        background: white;
        padding: 48px;
        border-radius: 12px;
        box-shadow: 0 1px 3px rgba(0, 0, 0, 0.06);
        border: 1px solid #e2e8f0;
      }

      .info-section h2 {
        font-size: 1.8em;
        font-weight: 700;
        color: #1a202c;
        margin-bottom: 24px;
      }

      .info-section p {
        color: #4a5568;
        font-size: 1.05em;
        margin-bottom: 20px;
        line-height: 1.7;
      }

      .no-data {
        text-align: center;
        padding: 64px 20px;
        color: #a0aec0;
        font-size: 1.1em;
      }

      .loading {
        text-align: center;
        padding: 64px 20px;
        color: #4a5568;
        font-size: 1.2em;
      }

      .loading::after {
        content: "...";
        animation: dots 1.5s steps(4, end) infinite;
      }

      @keyframes dots {
        0%,
        20% {
          content: ".";
        }

        40% {
          content: "..";
        }

        60%,
        100% {
          content: "...";
        }
      }

      @media (max-width: 768px) {
        body {
          padding: 10px;
        }

        h1 {
          font-size: 1.8em;
        }

        .stats {
          grid-template-columns: 1fr;
        }

        .stat-card {
          padding: 24px;
        }

        table {
          font-size: 0.9em;
        }

        th,
        td {
          padding: 12px 16px;
        }

        .info-section {
          padding: 32px 24px;
        }
      }

      .subtitle a {
        color: #295884;
        text-decoration: none;
      }

      .subtitle a:hover {
        color: #0e161f;
        text-decoration: underline;
      }
    </style>
  </head>

  <body>
    <div class="container">
      <header>
        <h1>
          Tracking Complaints Against Schools, Universities and Education
          Programs
        </h1>
        <p class="subtitle">
          By <a href="https://ananyabchetia.github.io/">Ananya Chetia</a>
        </p>
      </header>

      <div class="stats" id="stats">
        <div class="stat-card">
          <div class="stat-number" id="totalComplaints">-</div>
          <div class="stat-label">Total Complaints</div>
        </div>
        <div class="stat-card">
          <div class="stat-number" id="latestDate">-</div>
          <div class="stat-label">Most Recent</div>
        </div>
      </div>

      <div class="search-box">
        <div class="search-wrapper">
          <span class="search-icon">üîç</span>
          <input
            type="text"
            id="searchInput"
            placeholder="Search by institution name..."
          />
        </div>
      </div>

      <div class="table-container">
        <div id="loading" class="loading">Loading data</div>
        <table id="complaintsTable" style="display: none">
          <thead>
            <tr>
              <th onclick="sortTable(0)">Complaint Against</th>
              <th onclick="sortTable(1)">Date Filed</th>
              <th>Complaint Link</th>
            </tr>
          </thead>
          <tbody id="tableBody"></tbody>
        </table>
      </div>

      <div class="view-all-btn" id="viewAllContainer" style="display: none">
        <button class="btn" id="viewAllBtn" onclick="toggleViewAll()">
          View All Complaints
        </button>
      </div>

      <div class="info-section">
        <h2>More about the live tracker</h2>
        <p>
          The Equal Protection Project, an initiative of the conservative
          nonprofit Legal Insurrection Foundation, filed over 100 complaints
          against universities nationwide and challenged over 700 scholarships
          on the basis of race- or gender-based discrimination.
        </p>
        <p>
          My website auto updates every two weeks and identifies which
          universities, schools or programs has EPP filed a complaint against
          next.
        </p>
        <p>
          In my upcoming story for Chalkbeat New York, my analysis shows that
          after the EPP files complaints against race-based or minority
          scholarships for students of color, universities quietly remove these
          scholarships or alter the language of it so that it no longer
          exclusively supports a marginalized community.
        </p>
        <p>
          Feel free to use my tool to identify if your university is on the list
          and check out my website regularly for the latest updates.
        </p>
      </div>
    </div>

    <script>
      let allData = [];
      let currentData = [];
      let showingAll = false;
      let sortDirection = 1;
      let lastSortColumn = -1;

      async function loadData() {
        try {
          const response = await fetch("data/complaints.csv");
          const csvText = await response.text();

          Papa.parse(csvText, {
            header: true,
            skipEmptyLines: true,
            complete: function (results) {
              allData = results.data;
              currentData = allData;
              updateStats();
              displayData();
              document.getElementById("loading").style.display = "none";
              document.getElementById("complaintsTable").style.display =
                "table";

              if (allData.length > 5) {
                document.getElementById("viewAllContainer").style.display =
                  "block";
              }
            },
          });
        } catch (error) {
          document.getElementById("loading").innerHTML =
            '<div class="no-data">Error loading data. Please make sure complaints.csv exists in the data folder.</div>';
          console.error("Error loading CSV:", error);
        }
      }

      function updateStats() {
        const totalComplaints = allData.length;
        document.getElementById("totalComplaints").textContent =
          totalComplaints;

        if (allData.length > 0) {
          const dates = allData.map(
            (row) => new Date(row["Date of Complaint"]),
          );
          const latestDate = new Date(Math.max(...dates));
          document.getElementById("latestDate").textContent =
            latestDate.toLocaleDateString("en-US", {
              month: "short",
              day: "numeric",
              year: "numeric",
            });
        }
      }

      function sortTable(column) {
        if (lastSortColumn === column) {
          sortDirection *= -1;
        } else {
          sortDirection = 1;
          lastSortColumn = column;
        }

        currentData.sort((a, b) => {
          let valA, valB;
          if (column === 0) {
            valA = a.Complaint;
            valB = b.Complaint;
            return sortDirection * valA.localeCompare(valB);
          } else if (column === 1) {
            valA = new Date(a["Date of Complaint"]);
            valB = new Date(b["Date of Complaint"]);
            return sortDirection * (valA - valB);
          }
        });

        displayData();
      }

      function displayData() {
        const tbody = document.getElementById("tableBody");
        tbody.innerHTML = "";

        if (currentData.length === 0) {
          tbody.innerHTML =
            '<tr><td colspan="3" class="no-data">No complaints found</td></tr>';
          return;
        }

        const sortedData = currentData.sort(
          (a, b) =>
            new Date(b["Date of Complaint"]) - new Date(a["Date of Complaint"]),
        );

        const displayData = showingAll ? sortedData : sortedData.slice(0, 5);

        displayData.forEach((row) => {
          const tr = document.createElement("tr");

          const dateFormatted = new Date(
            row["Date of Complaint"],
          ).toLocaleDateString("en-US", {
            year: "numeric",
            month: "short",
            day: "numeric",
          });

          tr.innerHTML = `
                    <td>${row.Complaint}</td>
                    <td>${dateFormatted}</td>
                    <td><a href="${row.Link}" target="_blank" class="complaint-link">View</a></td>
                `;

          tbody.appendChild(tr);
        });
      }

      function toggleViewAll() {
        showingAll = !showingAll;
        const btn = document.getElementById("viewAllBtn");
        btn.textContent = showingAll ? "Show Less" : "View All Complaints";
        displayData();
      }

      document.getElementById("searchInput").addEventListener("input", (e) => {
        const searchTerm = e.target.value.toLowerCase();
        showingAll = false;

        currentData = allData.filter((row) =>
          row.Complaint.toLowerCase().includes(searchTerm),
        );

        const viewAllContainer = document.getElementById("viewAllContainer");
        const viewAllBtn = document.getElementById("viewAllBtn");

        if (currentData.length > 5) {
          viewAllContainer.style.display = "block";
          viewAllBtn.textContent = "View All Complaints";
        } else {
          viewAllContainer.style.display = "none";
        }

        displayData();
      });

      loadData();
    </script>
  </body>
</html>
